(function(e,i){typeof exports=="object"&&typeof module<"u"?module.exports=i(require("vue"),require("lkt-string-tools"),require("lkt-http-client")):typeof define=="function"&&define.amd?define(["vue","lkt-string-tools","lkt-http-client"],i):(e=typeof globalThis<"u"?globalThis:e||self,e.LktFieldFile=i(e.Vue,e.LktStringTools,e.LktHttpClient))})(this,function(e,i,S){"use strict";const b=["data-disabled"],w=["name","id","disabled","readonly","placeholder","accept"],V=["for","innerHTML"],C={class:"lkt-field-file-preview"},F=["src"],M={key:2,class:"lkt-field-file-preview-txt"},x={key:3,class:"lkt-field-file-preview-txt"},E={name:"LktFieldFile",inheritAttrs:!1},L=e.defineComponent({...E,props:{modelValue:{type:String,default:""},name:{type:String,default:i.generateRandomString(16)},label:{type:String,default:""},resource:{type:String,default:""},resourceData:{type:Object,default:()=>({})},accept:{type:String,default:"*/*"},placeholder:{type:String,default:""},palette:{type:String,default:""},readMode:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},allowReadModeSwitch:{type:Boolean,default:!1},tabindex:{type:Number,default:void 0},mandatory:{type:Boolean,default:!1},reset:{type:Boolean,default:!1},resetMessage:{type:String,default:""},mandatoryMessage:{type:String,default:""},infoMessage:{type:String,default:""},errorMessage:{type:String,default:""},switchEditionMessage:{type:String,default:""}},emits:["update:modelValue","uploading","upload-success","upload-error"],setup(l,{expose:N,emit:v}){const d=v,t=l,k=i.generateRandomString(16),u=e.ref(null);e.ref(t.modelValue);const n=e.ref(t.modelValue),s=e.ref(!t.readMode),y=e.ref(!1),h=e.ref(!1),r=e.ref(!1),p=()=>{y.value=n.value.includes("image/"),h.value=n.value.includes("text/")};p();const R=a=>{let o=a.target;if(o.files&&o.files[0]){const c=new FileReader;c.onload=m=>{if(n.value=m.target.result,p(),t.resource){r.value=!0,d("uploading");let B=JSON.parse(JSON.stringify(t.resourceData));B.files=o.files[0],S.httpCall(t.resource,B).then(f=>{n.value=f.data,r.value=!1,d("upload-success",f)}).catch(f=>{r.value=!1,d("upload-error",f)})}},c.readAsDataURL(o.files[0])}},T=e.computed(()=>{const a=["lkt-field","lkt-field-file"];return t.palette&&a.push(`lkt-field--${t.palette}`),t.disabled&&a.push("is-disabled"),a.push(t.modelValue?"is-filled":"is-empty"),a.join(" ")}),g=e.computed(()=>!t.disabled&&!t.readonly&&s.value);e.watch(()=>t.readMode,a=>s.value=!a),e.watch(()=>t.modelValue,a=>{n.value=a,p()}),e.watch(n,()=>d("update:modelValue",n.value));const D=()=>{!g.value||u.value.click()};return N({click:()=>u.value.click()}),(a,o)=>{const c=e.resolveComponent("lkt-loader");return e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(T.value),"data-disabled":l.disabled},[e.renderSlot(a.$slots,"prefix"),e.createElementVNode("input",{type:"file",ref:m=>u.value=m,name:l.name,id:e.unref(k),disabled:l.disabled||!s.value,readonly:l.readonly||!s.value,placeholder:l.placeholder,accept:l.accept,onChange:R},null,40,w),l.label?e.withDirectives((e.openBlock(),e.createElementBlock("label",{key:0,for:e.unref(k),innerHTML:l.label},null,8,V)),[[e.vShow,!l.disabled&&!l.readonly]]):e.createCommentVNode("",!0),e.createElementVNode("div",C,[r.value?(e.openBlock(),e.createBlock(c,{key:0})):y.value?(e.openBlock(),e.createElementBlock("img",{key:1,class:"lkt-field-file-preview-img",src:n.value},null,8,F)):h.value?(e.openBlock(),e.createElementBlock("span",M,"txt")):n.value?(e.openBlock(),e.createElementBlock("span",x,"file")):e.createCommentVNode("",!0),g.value?(e.openBlock(),e.createElementBlock("div",{key:4,class:"lkt-field-upload-button",onClick:e.withModifiers(D,["prevent","stop"])})):e.createCommentVNode("",!0)])],10,b)}}}),_="";return{install:l=>{l.component("lkt-field-file",L)}}});
